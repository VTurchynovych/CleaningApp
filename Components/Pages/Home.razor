@page "/"
@using CleaningApp.Models
@using CleaningApp.Data.Services
@using Microsoft.AspNetCore.Components.Authorization
@inject OrderService _orderService
@rendermode InteractiveServer

<div class="hero-section">
    <div class="container text-center">
        <h1 class="display-3 fw-bold animate-up">Czystość, która inspiruje</h1>
        <p class="lead mb-4 animate-up delay-1">Profesjonalne usługi sprzątania dla Twojego domu i biura.<br />Zarezerwuj termin online w mniej niż 3 minuty.</p>

        <div class="animate-up delay-2">
            <AuthorizeView>
                <Authorized>
                    <a href="client-services" class="btn btn-primary rounded-pill px-5 shadow-lg py-3 fw-bold">
                        📋 Zobacz nasze usługi
                    </a>
                </Authorized>
                <NotAuthorized>
                    <a href="Account/Register" class="btn btn-primary rounded-pill px-5 shadow-lg py-3 fw-bold">
                        📋 Utworz konto i zobacz nasze usługi
                    </a>
                </NotAuthorized>
            </AuthorizeView>
        </div>
    </div>
</div>

<div class="bg-pattern py-5">
    <div class="container my-5">
        <div class="text-center mb-5">
            <h2 class="fw-bold">Dlaczego warto nam zaufać?</h2>
        </div>

        <div class="row g-4">
            <div class="col-md-4">
                <div class="card feature-card h-100 p-4 text-center">
                    <div class="icon-box icon-box-green"><i class="bi bi-shield-check"></i></div>

                    <h4 class="fw-bold">Bezpieczeństwo</h4>
                    <p class="text-muted">Nasi pracownicy są weryfikowani, a każda usługa jest ubezpieczona. Śpij spokojnie, my sprzątamy.</p>
                </div>
            </div>

            <div class="col-md-4">
                <div class="card feature-card h-100 p-4 text-center">
                    <div class="icon-box icon-box-blue"><i class="bi bi-gem"></i></div>

                    <h4 class="fw-bold">Jakość Premium</h4>
                    <p class="text-muted">Używamy tylko certyfikowanych, ekologicznych środków czystości, bezpiecznych dla dzieci i zwierząt.</p>
                </div>
            </div>

            <div class="col-md-4">
                <div class="card feature-card h-100 p-4 text-center">
                    <div class="icon-box icon-box-orange"><i class="bi bi-clock-history"></i></div>

                    <h4 class="fw-bold">Punktualność</h4>
                    <p class="text-muted">Szanujemy Twój czas. Zawsze jesteśmy na czas, a status zlecenia śledzisz w aplikacji.</p>
                </div>
            </div>
        </div>
    </div>
</div>

<div class="bg-light py-5 testimonial-section">
    <div class="container">
        <div class="text-center mb-5">
            <h2 class="fw-bold">Co mówią o nas klienci?</h2>
        </div>

        @if (displayReviews == null)
        {
            <div class="text-center"><div class="spinner-border text-primary"></div></div>
        }
        else if (!displayReviews.Any())
        {
            <div class="text-center text-muted py-5"><p>Jeszcze brak opinii. Zamów usługę i bądź pierwszy!</p></div>
        }
        else
        {
            <div id="reviewsCarousel" class="carousel slide" data-bs-ride="carousel" data-bs-interval="5000">

                <div class="carousel-inner">
                    @for (int i = 0; i < displayReviews.Count; i++)
                    {
                        var review = displayReviews[i];
                        <div class="carousel-item @(i == 0 ? "active" : "")">
                            <div class="testimonial-card">
                                <div class="testimonial-content">
                                    <div class="avatar-circle">
                                        @(!string.IsNullOrEmpty(review.Client?.FullName) ? review.Client.FullName[0].ToString().ToUpper() : "K")
                                    </div>

                                    <div class="fs-4 text-warning mb-3">
                                        @for (int s = 0; s < (review.Rating ?? 5); s++)
                                        {
                                            <i class="bi bi-star-fill mx-1"></i>
                                        }
                                    </div>

                                    <h4 class="fst-italic mb-4 lh-base text-dark">"@review.ClientComment"</h4>

                                    <div class="d-flex flex-column justify-content-center align-items-center">
                                        <h6 class="fw-bold mb-0 text-uppercase text-primary" style="letter-spacing: 1px;">
                                            @(review.Client?.FullName ?? "Anonimowy Klient")
                                        </h6>
                                        <small class="text-muted mt-1">
                                            Usługa: <span class="fw-semibold">@(review.Service?.Name ?? "Sprzątanie")</span>
                                        </small>
                                    </div>
                                </div>
                            </div>
                        </div>
                    }
                </div>

                @if (displayReviews.Count > 1)
                {
                    <button class="carousel-control-prev" type="button" data-bs-target="#reviewsCarousel" data-bs-slide="prev" style="width: 5%;">
                        <div class="carousel-btn-custom">
                            <span class="carousel-control-prev-icon" aria-hidden="true"></span>
                        </div>
                    </button>
                    <button class="carousel-control-next" type="button" data-bs-target="#reviewsCarousel" data-bs-slide="next" style="width: 5%;">
                        <div class="carousel-btn-custom">
                            <span class="carousel-control-next-icon" aria-hidden="true"></span>
                        </div>
                    </button>
                }

                @if (displayReviews.Count > 1)
                {
                    <div class="carousel-indicators" style="bottom: -20px;">
                        @for (int i = 0; i < displayReviews.Count; i++)
                        {
                            <button type="button" data-bs-target="#reviewsCarousel" data-bs-slide-to="@i"
                                    class="@(i == 0 ? "active" : "") bg-primary" aria-current="true"
                                    style="width: 10px; height: 10px; border-radius: 50%; margin: 0 5px; opacity: 0.7;">
                            </button>
                        }
                    </div>
                }
            </div>
        }
    </div>
</div>



<div class="bg-pattern py-5">
    <div class="container my-5">
        <div class="row align-items-center">
            <div class="col-md-6">
                <img src="/img/about-us.jpg" alt="Nasz zespół" class="img-fluid about-img mb-4 mb-md-0"
                     onerror="this.src='https://via.placeholder.com/600x400?text=Zdjecie+Zespolu'" />
            </div>
            <div class="col-md-6 ps-md-5">
                <h6 class="text-primary fw-bold text-uppercase">O Naszej Firmie</h6>
                <h2 class="fw-bold mb-4">Tworzymy przestrzeń do życia</h2>
                <p class="text-muted mb-4">
                    Jesteśmy zespołem pasjonatów, dla których sprzątanie to nie tylko praca, ale misja.
                </p>
                <ul class="list-unstyled mb-4">
                    <li class="mb-2"><i class="bi bi-check-circle-fill text-success me-2"></i> Certyfikowani pracownicy</li>
                    <li class="mb-2"><i class="bi bi-check-circle-fill text-success me-2"></i> Ekologiczne środki</li>
                    <li class="mb-2"><i class="bi bi-check-circle-fill text-success me-2"></i> Gwarancja satysfakcji</li>
                </ul>
            </div>
        </div>
    </div>
</div>

@code {

    private List<Order> topReviews;
    private List<Order> displayReviews; // Lista, którą wyświetlamy (baza + mocki)

    protected override async Task OnInitializedAsync()
    {
        // 1. Pobieramy prawdziwe opinie z bazy
        topReviews = await _orderService.GetTopReviewsAsync();

        // 2. Tworzymy listę do wyświetlenia
        displayReviews = new List<Order>();
        if (topReviews != null) displayReviews.AddRange(topReviews);

        // 3. Jeśli mamy mało opinii, dodajemy "sztuczne" dla lepszego efektu wizualnego
        if (displayReviews.Count < 3)
        {
            AddMockReviews();
        }
    }

    private void AddMockReviews()
    {
        // To są przykładowe opinie, żeby karuzela ładnie wyglądała na początku
        displayReviews.Add(new Order
        {
            Rating = 5,
            ClientComment = "Jestem zachwycona! Mieszkanie lśni czystością, a obsługa była przemiła. Polecam każdemu.",
            Client = new ApplicationUser { FullName = "Anna Nowak" },
            Service = new Service { Name = "Sprzątanie Generalne" }
        });

        displayReviews.Add(new Order
        {
            Rating = 5,
            ClientComment = "Profesjonalizm w każdym calu. Punktualnie, dokładnie i w dobrej cenie. Na pewno skorzystam ponownie.",
            Client = new ApplicationUser { FullName = "Piotr Wiśniewski" },
            Service = new Service { Name = "Mycie Okien" }
        });

        displayReviews.Add(new Order
        {
            Rating = 5,
            ClientComment = "Ekologiczne środki to dla mnie priorytet przy dzieciach. Firma spełniła wszystkie moje oczekiwania.",
            Client = new ApplicationUser { FullName = "Katarzyna Wójcik" },
            Service = new Service { Name = "Pranie Dywanów" }
        });
    }
}